import{a as fe}from"./chunk-JGYDC2CF.js";import{a as A,b as ve,c as ge}from"./chunk-HEAJPEDD.js";import{b as _e,c as B}from"./chunk-EEDA453I.js";import{a as Ce,b as U,c as N}from"./chunk-XXFHMGJY.js";import{a as oe,b as de,c as le,f as me,k as se,l as xe}from"./chunk-CXNVOOXP.js";import"./chunk-YTDSK5ZT.js";import{a as Q,d as W}from"./chunk-TWCHZGE4.js";import{$a as ne,Ha as H,Ma as J,Na as K,Pa as X,Ra as Y,Ta as Z,Ua as ee,Xa as te,_ as G,_a as ie,da as q,eb as re,gb as ae,hb as ce,i as $,ib as pe,jb as ue,k as z,l as j}from"./chunk-3VDJTOIS.js";import{$a as I,Cb as R,Db as x,Fb as V,Gb as E,Hb as w,Ib as i,Jb as t,Kb as g,Ob as b,Rb as h,Tb as m,Tc as F,Uc as M,Wb as D,Xb as L,bc as r,cb as a,cc as c,dc as p,ec as P,jc as T,ka as _,nc as u,oa as k,oc as f,pc as O,wb as v,xa as C,ya as S,yb as y}from"./chunk-XXTPASVJ.js";var Ee=(n,d)=>d.productId+"-"+d.size;function we(n,d){if(n&1&&(i(0,"dl")(1,"dt",8),r(2,"Cancellation reason"),t(),i(3,"dd",9),r(4),t()()),n&2){let e=m(2);a(4),c(e.order.cancelledReason)}}function Ie(n,d){if(n&1&&(i(0,"a",24),r(1,"Track"),t()),n&2){let e=m(3);y("href",e.order.trackingUrl,I)}}function De(n,d){if(n&1&&(i(0,"dl")(1,"dt",8),r(2,"Tracking"),t(),i(3,"dd",9)(4,"span"),r(5),t(),v(6,Ie,2,1,"a",24),t()()),n&2){let e=m(2);a(5),c(e.order.trackingNumber),a(),x(e.order.trackingUrl?6:-1)}}function Oe(n,d){if(n&1&&(i(0,"dl")(1,"dt",8),r(2,"Delivery update"),t(),i(3,"dd",9),r(4),t()()),n&2){let e=m(2);a(4),c(e.order.deliveryUpdateDetails)}}function ke(n,d){if(n&1&&(i(0,"mat-option",29),r(1),t()),n&2){let e=d.$implicit;y("value",e),a(),c(e)}}function Re(n,d){n&1&&(i(0,"mat-form-field",27)(1,"mat-label"),r(2,"Tracking number"),t(),g(3,"input",34),t(),i(4,"mat-form-field",27)(5,"mat-label"),r(6,"Tracking URL"),t(),g(7,"input",35),t())}function Te(n,d){n&1&&(i(0,"mat-form-field",30)(1,"mat-label"),r(2,"Cancel reason"),t(),g(3,"textarea",36),t())}function Fe(n,d){if(n&1){let e=b();i(0,"div",11)(1,"h4",25),r(2,"Order management"),t(),i(3,"form",26),h("ngSubmit",function(){C(e);let l=m(2);return S(l.updateStatus())}),i(4,"mat-form-field",27)(5,"mat-label"),r(6,"Status"),t(),i(7,"mat-select",28),E(8,ke,2,2,"mat-option",29,V),t()(),v(10,Re,8,0)(11,Te,4,0,"mat-form-field",30),i(12,"mat-form-field",30)(13,"mat-label"),r(14,"Delivery update details"),t(),g(15,"textarea",31),t(),i(16,"div",32)(17,"button",33),r(18,"Update status"),t()()()()}if(n&2){let e,o,l=m(2);a(3),y("formGroup",l.statusForm),a(5),w(l.adminStatusOptions),a(2),x(((e=l.statusForm.get("status"))==null?null:e.value)==="Shipped"?10:-1),a(),x(((o=l.statusForm.get("status"))==null?null:o.value)==="Cancelled"?11:-1)}}function Me(n,d){if(n&1){let e=b();i(0,"div",11)(1,"h4",25),r(2,"Cancel order"),t(),i(3,"form",26),h("ngSubmit",function(){C(e);let l=m(2);return S(l.cancelOrder())}),i(4,"mat-form-field",30)(5,"mat-label"),r(6,"Reason (optional)"),t(),g(7,"textarea",37),t(),i(8,"div",32)(9,"button",38),r(10,"Cancel order"),t()()()()}if(n&2){let e=m(2);a(3),y("formGroup",e.cancelForm)}}function Ae(n,d){if(n&1){let e=b();g(0,"app-star-rating",46),i(1,"span",47),r(2),u(3,"date"),t(),i(4,"button",48),h("click",function(){C(e);let l=m().$implicit,s=m(2);return S(s.openReviewDialog(l))}),r(5,"Edit review"),t()}if(n&2){let e=m().$implicit;y("value",e.reviewRating),a(2),c(O(3,2,e.reviewDate,"mediumDate"))}}function Ue(n,d){if(n&1){let e=b();i(0,"button",49),h("click",function(){C(e);let l=m().$implicit,s=m(2);return S(s.openReviewDialog(l))}),r(1,"Write a review"),t()}}function Ne(n,d){if(n&1){let e=b();i(0,"button",49),h("click",function(){C(e);let l=m().$implicit,s=m(2);return S(s.openReviewDialog(l))}),r(1,"Edit review"),t()}}function Be(n,d){if(n&1&&(i(0,"tr")(1,"td",39)(2,"div",40),g(3,"img",41),i(4,"span"),r(5),t()(),i(6,"div",42),v(7,Ae,6,5)(8,Ue,2,0,"button",43)(9,Ne,2,0,"button",43),t()(),i(10,"td",44),r(11),t(),i(12,"td",44),r(13),t(),i(14,"td",45),r(15),u(16,"currency"),t()()),n&2){let e=d.$implicit;a(3),D("src",e.pictureUrl,I),a(2),c(e.productName),a(2),x(e.reviewRating?7:e.canReview?8:e.reviewId?9:-1),a(4),c(e.size),a(2),p("x",e.quantity,""),a(2),c(f(16,6,e.price))}}function Ve(n,d){if(n&1){let e=b();i(0,"mat-card",0)(1,"div",1)(2,"div",2)(3,"h2",3),r(4),t(),i(5,"button",4),h("click",function(){C(e);let l=m();return S(l.onReturnClick())}),r(6),t()(),i(7,"div",5)(8,"div",6)(9,"h4",7),r(10,"Billing and delivery information"),t(),i(11,"dl")(12,"dt",8),r(13,"Shipping address"),t(),i(14,"dd",9),r(15),u(16,"address"),t()(),i(17,"dl")(18,"dt",8),r(19,"Payment info"),t(),i(20,"dd",9),r(21),u(22,"paymentCard"),t()()(),i(23,"div",6)(24,"h4",7),r(25,"Order details"),t(),i(26,"dl")(27,"dt",8),r(28,"Email address"),t(),i(29,"dd",9),r(30),t()(),i(31,"dl")(32,"dt",8),r(33,"Order status"),t(),i(34,"dd",10)(35,"span"),r(36),t()()(),v(37,we,5,1,"dl")(38,De,7,2,"dl")(39,Oe,5,1,"dl"),i(40,"dl")(41,"dt",8),r(42,"Order date"),t(),i(43,"dd",9),r(44),u(45,"date"),t()()()(),v(46,Fe,19,3,"div",11)(47,Me,11,1,"div",11),i(48,"div",12)(49,"div",13)(50,"table",14)(51,"tbody",15),E(52,Be,17,8,"tr",null,Ee),t()()()(),i(54,"div",16)(55,"p",17),r(56,"Order summary"),t(),i(57,"div",18)(58,"div",6)(59,"dl",19)(60,"dt",20),r(61,"Subtotal"),t(),i(62,"dd",21),r(63),u(64,"currency"),t()(),i(65,"dl",19)(66,"dt",20),r(67,"Discount"),t(),i(68,"dd",22),r(69),u(70,"currency"),t()(),i(71,"dl",19)(72,"dt",20),r(73,"Delivery fee"),t(),i(74,"dd",21),r(75),u(76,"currency"),t()()(),i(77,"dl",23)(78,"dt",20),r(79,"Total"),t(),i(80,"dd",21),r(81),u(82,"currency"),t()()()()()()}if(n&2){let e=m();a(4),p("Order summary for order #",e.order.id,""),a(2),c(e.buttonText),a(9),c(f(16,18,e.order.shippingAddress)),a(6),c(f(22,20,e.order.paymentSummary)),a(9),c(e.order.buyerEmail),a(5),R("rounded-full px-3 py-1 text-xs font-medium ",e.statusClasses[e.order.status]||"bg-gray-100 text-gray-700",""),a(),p(" ",e.statusLabels[e.order.status]||e.order.status," "),a(),x(e.order.cancelledReason?37:-1),a(),x(e.order.trackingNumber?38:-1),a(),x(e.order.deliveryUpdateDetails?39:-1),a(5),c(O(45,22,e.order.orderDate,"medium")),a(2),x(e.isAdmin?46:e.canCancelOrder?47:-1),a(6),w(e.order.orderItems),a(11),p(" ",f(64,25,e.order.subtotal)," "),a(6),p(" -",f(70,27,e.order.discount)," "),a(6),p(" ",f(76,29,e.order.shippingPrice)," "),a(6),p(" ",f(82,31,e.order.total)," ")}}var Se=(()=>{let d=class d{constructor(){this.orderService=_(A),this.activatedRoute=_($),this.accountService=_(_e),this.adminService=_(Ce),this.router=_(z),this.reviewService=_(xe),this.dialog=_(me),this.snackbar=_(ue),this.fb=_(re),this.statusLabels=U,this.statusClasses=N,this.buttonText=this.accountService.isAdmin()?"Return to admin":"Return to orders",this.adminStatusOptions=["Pending","PaymentReceived","PaymentFailed","PaymentMismatch","Processing","Packed","Shipped","Delivered","Cancelled","Refunded"],this.statusForm=this.fb.group({status:["",Y.required],cancelReason:[""],trackingNumber:[""],trackingUrl:[""],deliveryDetails:[""]}),this.cancelForm=this.fb.group({reason:[""]})}ngOnInit(){this.loadOrder()}onReturnClick(){this.accountService.isAdmin()?this.router.navigateByUrl("/admin"):this.router.navigateByUrl("/orders")}loadOrder(){let o=this.activatedRoute.snapshot.paramMap.get("id");if(!o)return;(this.accountService.isAdmin()?this.adminService.getOrder(+o):this.orderService.getOrderDetailed(+o)).subscribe({next:s=>{this.order=s,this.accountService.isAdmin()&&this.statusForm.patchValue({status:s.status,cancelReason:s.cancelledReason??"",trackingNumber:s.trackingNumber??"",trackingUrl:s.trackingUrl??"",deliveryDetails:s.deliveryUpdateDetails??""},{emitEvent:!1})},error:()=>this.order=void 0})}updateStatus(){if(!this.order)return;if(this.statusForm.invalid){this.statusForm.markAllAsTouched();return}let o=this.statusForm.value,l={status:o.status??"",cancelReason:o.cancelReason?.toString().trim()||void 0,trackingNumber:o.trackingNumber?.toString().trim()||void 0,trackingUrl:o.trackingUrl?.toString().trim()||void 0,deliveryDetails:o.deliveryDetails?.toString().trim()||void 0};this.adminService.updateOrderStatus(this.order.id,l).subscribe({next:()=>{this.snackbar.success("Order status updated"),this.loadOrder()},error:s=>this.snackbar.error(s?.error||"Unable to update order status")})}cancelOrder(){if(!this.order)return;let o=this.cancelForm.value.reason?.toString().trim()||void 0;this.orderService.cancelOrder(this.order.id,o).subscribe({next:l=>{this.order=l,this.snackbar.success("Order cancelled")},error:l=>this.snackbar.error(l?.error||"Unable to cancel order")})}get canCancelOrder(){return!this.order||this.accountService.isAdmin()?!1:!["Cancelled","Shipped","Delivered","Refunded"].includes(this.order.status)}get isAdmin(){return this.accountService.isAdmin()}openReviewDialog(o){let l=o.reviewId?this.reviewService.getMyReview(o.productId):null;l?l.subscribe({next:s=>this.launchReviewDialog(o,s),error:()=>this.launchReviewDialog(o)}):this.launchReviewDialog(o)}launchReviewDialog(o,l){this.dialog.open(fe,{width:"520px",data:{productId:o.productId,productName:o.productName,orderId:this.order?.id,review:l}}).afterClosed().subscribe({next:he=>{he&&(this.snackbar.success(l?"Review updated":"Review added"),this.loadOrder())}})}};d.\u0275fac=function(l){return new(l||d)},d.\u0275cmp=k({type:d,selectors:[["app-order-detailed"]],standalone:!0,features:[T],decls:1,vars:1,consts:[[1,"bg-white","py-8","shadow-md","max-w-screen-lg","mx-auto"],[1,"px-4","w-full"],[1,"flex","justify-between","items-center","align-middle"],[1,"text-2xl","text-center","font-semibold"],["mat-stroked-button","",3,"click"],[1,"mt-8","py-3","border-t","border-gray-200","flex","gap-16"],[1,"space-y-2"],[1,"text-lg","font-semibold"],[1,"font-medium"],[1,"mt-1","font-light"],[1,"mt-1"],[1,"mt-6","border-t","border-gray-200","pt-6"],[1,"mt-4"],[1,"border-y","border-gray-200"],[1,"w-full","text-center"],[1,"divide-y","divide-gray-200"],[1,"space-y-4","rounded-lg","border-y","border-gray-200","p-4","bg-white"],[1,"text-xl","font-semibold"],[1,"space-y-4"],[1,"flex","items-center","justify-between","gap-4"],[1,"font-medium","text-gray-500"],[1,"font-medium","text-gray-900"],[1,"font-medium","text-green-500"],[1,"flex","items-center","justify-between","gap-4","border-t","border-gray-200","pt-2"],["target","_blank","rel","noopener",1,"ml-2","text-primary","hover:underline",3,"href"],[1,"text-lg","font-semibold","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4",3,"ngSubmit","formGroup"],["appearance","outline",1,"w-full"],["formControlName","status"],[3,"value"],["appearance","outline",1,"w-full","md:col-span-2"],["matInput","","formControlName","deliveryDetails","rows","2"],[1,"md:col-span-2","flex","justify-end"],["mat-flat-button","","color","primary","type","submit"],["matInput","","formControlName","trackingNumber"],["matInput","","formControlName","trackingUrl"],["matInput","","formControlName","cancelReason","rows","2"],["matInput","","formControlName","reason","rows","2"],["mat-stroked-button","","color","warn","type","submit"],[1,"py-4"],[1,"flex","items-center","gap-4"],["alt","product image",1,"w-10","h-10",3,"src"],[1,"mt-2","flex","items-center","gap-3","text-xs","text-gray-700"],["mat-stroked-button","","color","primary",1,"px-2"],[1,"p-4"],[1,"p-4","text-right"],["size","sm",3,"value"],[1,"text-gray-500"],["mat-button","","color","primary",1,"px-2",3,"click"],["mat-stroked-button","","color","primary",1,"px-2",3,"click"]],template:function(l,s){l&1&&v(0,Ve,83,33,"mat-card",0),l&2&&x(s.order?0:-1)},dependencies:[W,Q,q,F,M,ve,ge,se,le,ae,te,X,Z,ee,ie,ne,K,J,H,pe,ce,de,oe,G]});let n=d;return n})();var Le=(n,d)=>d.id,Pe=(n,d)=>d.productId+"-"+d.size;function $e(n,d){if(n&1&&(i(0,"div",8),g(1,"img",13),i(2,"div",14)(3,"p",15),r(4),t(),i(5,"p",16),r(6),t()(),i(7,"div",17),r(8),u(9,"currency"),t()()),n&2){let e=d.$implicit;a(),D("src",e.pictureUrl,I),D("alt",e.productName),a(3),p(" ",e.productName," "),a(2),P("Size ",e.size," | Qty ",e.quantity,""),a(2),p(" ",f(9,6,e.price)," ")}}function ze(n,d){if(n&1&&(i(0,"p",12),r(1),t()),n&2){let e=m(2).$implicit;a(),p(" ",e.totalItems-e.previewItems.length," more item(s) ")}}function je(n,d){if(n&1&&(i(0,"div",11),E(1,$e,10,8,"div",8,Pe),t(),v(3,ze,2,1,"p",12)),n&2){let e=m().$implicit;a(),w(e.previewItems),a(2),x(e.totalItems&&e.previewItems&&e.totalItems>e.previewItems.length?3:-1)}}function Ge(n,d){n&1&&(i(0,"p",6),r(1,"Items will appear here soon."),t())}function qe(n,d){if(n&1&&(i(0,"div",3)(1,"div",4)(2,"div",5)(3,"div")(4,"p",6),r(5),t(),i(6,"p",7),r(7),u(8,"date"),t(),i(9,"p",6),r(10),t()(),i(11,"div",8)(12,"span"),r(13),t(),i(14,"span",9),r(15),u(16,"currency"),t()()(),i(17,"div",10),v(18,je,4,1)(19,Ge,2,0,"p",6),t()()()),n&2){let e,o=d.$implicit,l=m();L("routerLink","/orders/",o.id,""),a(5),p("Order #",o.id,""),a(2),c(O(8,11,o.orderDate,"medium")),a(3),p(" Items: ",(e=(e=o.totalItems)!==null&&e!==void 0?e:o.previewItems==null?null:o.previewItems.length)!==null&&e!==void 0?e:0," "),a(2),R("rounded-full px-3 py-1 text-xs font-medium ",l.statusClasses[o.status]||"bg-gray-100 text-gray-700",""),a(),p(" ",l.statusLabels[o.status]||o.status," "),a(2),c(f(16,14,o.total)),a(3),x(o.previewItems!=null&&o.previewItems.length?18:19)}}var be=(()=>{let d=class d{constructor(){this.orderService=_(A),this.orders=[],this.statusLabels=U,this.statusClasses=N}ngOnInit(){this.orderService.getOrdersForUser().subscribe({next:o=>this.orders=o})}};d.\u0275fac=function(l){return new(l||d)},d.\u0275cmp=k({type:d,selectors:[["app-order"]],standalone:!0,features:[T],decls:6,vars:0,consts:[[1,"mx-auto","mt-32","max-w-5xl","px-4"],[1,"font-semibold","text-2xl","mb-6","text-center"],[1,"space-y-4"],[1,"cursor-pointer","rounded-lg","border","border-gray-200","bg-white","shadow-sm","transition","hover:border-gray-300","hover:shadow-md",3,"routerLink"],[1,"p-4"],[1,"flex","flex-wrap","items-start","justify-between","gap-4"],[1,"text-sm","text-gray-500"],[1,"font-semibold"],[1,"flex","items-center","gap-3"],[1,"text-lg","font-semibold"],[1,"mt-4","border-t","border-gray-100","pt-4"],[1,"grid","gap-3","sm:grid-cols-2"],[1,"mt-3","text-sm","text-gray-500"],[1,"h-12","w-12","rounded-md","border","border-gray-200","object-cover",3,"src","alt"],[1,"min-w-0","flex-1"],[1,"truncate","text-sm","font-medium","text-gray-900"],[1,"text-xs","text-gray-500"],[1,"text-sm","font-semibold","text-gray-900"]],template:function(l,s){l&1&&(i(0,"div",0)(1,"h2",1),r(2,"My orders"),t(),i(3,"div",2),E(4,qe,20,16,"div",3,Le),t()()),l&2&&(a(4),w(s.orders))},dependencies:[j,F,M]});let n=d;return n})();var Ft=[{path:"",component:be,canActivate:[B]},{path:":id",component:Se,canActivate:[B]}];export{Ft as orderRoutes};
