import{a as q,b as O,c as U,e as z,f as H,g as P,h as W,i as Q}from"./chunk-CDZYAJHF.js";import{Ga as D,Ia as I,La as F,Ma as E,Oa as T,Qa as d,Sa as k,Ta as A,Wa as N,Za as G,_a as L,ca as y,cb as V,db as j,ea as R,fb as B,gb as $,hb as J,ib as K}from"./chunk-NLYTDXKY.js";import{Db as M,Ib as e,Jb as i,Kb as b,Rb as g,Vc as C,bc as n,cb as a,db as w,dc as s,jc as x,ka as c,oa as _,wb as S,yb as f}from"./chunk-FFTV7VFC.js";function X(u,o){u&1&&(e(0,"span",7),n(1,"Select a rating"),i())}var vt=(()=>{let o=class o{constructor(r){this.data=r,this.dialogRef=c(O),this.fb=c(j),this.reviewService=c(Q),this.snackbar=c(K),this.submitting=!1,this.form=this.fb.group({rating:[this.data.review?.rating??0,[d.required,d.min(1),d.max(5)]],title:[this.data.review?.title??"",[d.maxLength(150)]],content:[this.data.review?.content??"",[d.maxLength(1e3)]]})}setRating(r){this.form.get("rating")?.setValue(r)}submit(){if(this.form.invalid){this.form.markAllAsTouched();return}let r={rating:this.form.value.rating??0,title:this.form.value.title??null,content:this.form.value.content??null,orderId:this.data.orderId??null},l=this.data.review?this.reviewService.updateReview(this.data.productId,this.data.review.id,r):this.reviewService.createReview(this.data.productId,r);this.submitting=!0,l.subscribe({next:t=>{this.snackbar.success(this.data.review?"Review updated":"Review added"),this.dialogRef.close(t)},error:t=>{this.submitting=!1,this.snackbar.error(t?.error||"Unable to save review")}})}};o.\u0275fac=function(l){return new(l||o)(w(U))},o.\u0275cmp=_({type:o,selectors:[["app-review-form-dialog"]],standalone:!0,features:[x],decls:28,vars:11,consts:[["mat-dialog-title","",1,"text-lg","font-semibold"],[1,"block","text-sm","font-normal","text-gray-500"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"space-y-4"],[1,"flex","items-center","gap-3"],[1,"text-sm","font-medium","text-gray-700"],["size","md",3,"valueChange","value","readonly"],[1,"text-sm","text-red-600"],["appearance","outline",1,"w-full"],["matInput","","formControlName","title","maxlength","150"],["align","end"],["matInput","","rows","4","formControlName","content","maxlength","1000"],["mat-button","","type","button",3,"click","disabled"],["mat-flat-button","","color","primary","type","submit",3,"disabled"]],template:function(l,t){if(l&1&&(e(0,"h2",0),n(1),e(2,"span",1),n(3),i()(),e(4,"form",2),g("ngSubmit",function(){return t.submit()}),e(5,"mat-dialog-content",3)(6,"div",4)(7,"span",5),n(8,"Rating *"),i(),e(9,"app-star-rating",6),g("valueChange",function(m){return t.setRating(m)}),i(),S(10,X,2,0,"span",7),i(),e(11,"mat-form-field",8)(12,"mat-label"),n(13,"Title (optional)"),i(),b(14,"input",9),e(15,"mat-hint",10),n(16),i()(),e(17,"mat-form-field",8)(18,"mat-label"),n(19,"Description (optional)"),i(),b(20,"textarea",11),e(21,"mat-hint",10),n(22),i()()(),e(23,"mat-dialog-actions",10)(24,"button",12),g("click",function(){return t.dialogRef.close()}),n(25,"Cancel"),i(),e(26,"button",13),n(27),i()()()),l&2){let p,m,v,h;a(),s(" ",t.data.review?"Edit your review":"Write a review"," "),a(2),s("for ",t.data.productName,""),a(),f("formGroup",t.form),a(5),f("value",((p=t.form.get("rating"))==null?null:p.value)||0)("readonly",!1),a(),M((m=t.form.get("rating"))!=null&&m.invalid&&((m=t.form.get("rating"))!=null&&m.touched)?10:-1),a(6),s("",((v=t.form.get("title"))==null||v.value==null?null:v.value.length)||0," / 150"),a(6),s("",((h=t.form.get("content"))==null||h.value==null?null:h.value.length)||0," / 1000"),a(2),f("disabled",t.submitting),a(2),f("disabled",t.submitting),a(),s(" ",t.data.review?"Update":"Submit"," ")}},dependencies:[C,W,z,P,H,E,F,D,I,J,$,R,y,B,N,T,k,A,V,G,L,q],styles:["mat-dialog-content[_ngcontent-%COMP%]{min-width:420px}"]});let u=o;return u})();export{vt as a};
